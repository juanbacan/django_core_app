{{ form.media }}

{% block extrajs %}
    {% include 'core/forms/form_js.html' %}
{% endblock extrajs %}

{# Incluir estilos comunes #}
<style>
    {% include 'core/forms/form_css.html' %}
</style>

<div class="modal-dialog modal-dialog-scrollable {% if modal_size %}{{ modal_size }}{% else %}modal-lg{% endif %}">
    <div class="modal-content">
        <div class="modal-header">

            <h4 class="modal-title">{% block title %}{{ title }}{% endblock title %}</h4>

            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close">
            </button>
        </div>

        <div class="modal-body">  
            <form 
                id="modalForm1" 
                class="form" 
                {% if url %}
                    action="{{ url }}" 
                {% else %}
                    action="{{ request.path }}"
                {% endif %}
                method="post" 
                enctype="multipart/form-data"
            >
                {% csrf_token %}
                <input type="hidden" name="action" value={% block formaction %}{{ action }}{% endblock formaction %}>
                <input type="hidden" name="id" value={% block formid %}{{ formid }}{% endblock formid %}>
                {% if campos_hidden %}
                    {% for key, value in campos_hidden.items %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endfor %}
                {% endif %}
                {% block formextra %}{% endblock formextra %}
                
                {% block formpreffix %}{% endblock formpreffix %}
                {% if form.helper %}
                    {# Si el formulario tiene helper, usar el sistema de layout #}
                    {{ form.helper.render_layout|safe }}
                    {# Solo renderizar inlines si no fueron renderizados en el layout #}
                    {% if form.inline_formsets and not form.inlines_rendered_in_layout %}
                        {% include 'core/forms/form_inline.html' %}
                    {% endif %}
                {% else %}
                    {# Fallback al sistema tradicional #}
                    {% include 'core/forms/formRender.html' %}
                {% endif %}
                {% block formsuffix %}{% endblock formsuffix %}

                <div class="modal-footer">
                    {% if delete_obj %}
                        <button 
                            class="btn btn-danger" 
                            type="button" 
                            onClick="submitModalForm1()"
                        >
                            <i class="fa-solid fa-trash"></i> Eliminar
                        </button>
                        <button class="btn btn-info" type="button" data-bs-dismiss="modal">Cerrar</button>
                    {% else %}
                        <button class="btn btn-danger" type="button" data-bs-dismiss="modal">Cancelar</button>
                        <button 
                            class="btn btn-primary" 
                            type="button" 
                            onClick="{% if not custom_submit_form %}submitModalForm1(){% else %}customSubmitForm(){% endif %}"
                        >
                            Confirmar
                        </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>
